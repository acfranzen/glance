{
  "version": 1,
  "type": "glance-widget",
  "meta": {
    "name": "GitHub Pull Requests",
    "slug": "github-prs",
    "description": "Shows open pull requests from specified GitHub repositories",
    "author": "zeus@openclaw",
    "created_at": "2026-02-03T16:00:00.000Z",
    "exported_at": "2026-02-03T16:00:00.000Z"
  },
  "widget": {
    "source_code": "function Widget() {\n  const config = useConfig();\n  const repos = config.repos || ['acfranzen/libra', 'acfranzen/glance'];\n  const { data, loading, error, refresh } = useData('github', { repos });\n\n  if (loading) {\n    return (\n      <Card className=\"h-full\">\n        <CardContent className=\"flex items-center justify-center h-full\">\n          <Loading message=\"Loading PRs...\" />\n        </CardContent>\n      </Card>\n    );\n  }\n\n  if (error) {\n    return (\n      <Card className=\"h-full\">\n        <CardContent className=\"flex items-center justify-center h-full\">\n          <ErrorDisplay message={error.message} retry={refresh} />\n        </CardContent>\n      </Card>\n    );\n  }\n\n  const prs = data?.prs || [];\n\n  const formatRelativeTime = (isoDate) => {\n    try {\n      const date = new Date(isoDate);\n      const now = new Date();\n      const diffMs = now.getTime() - date.getTime();\n      const diffMins = Math.floor(diffMs / 60000);\n      if (diffMins < 1) return 'just now';\n      if (diffMins < 60) return `${diffMins}m ago`;\n      const diffHours = Math.floor(diffMins / 60);\n      if (diffHours < 24) return `${diffHours}h ago`;\n      const diffDays = Math.floor(diffHours / 24);\n      if (diffDays < 7) return `${diffDays}d ago`;\n      return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });\n    } catch {\n      return 'unknown';\n    }\n  };\n\n  return (\n    <Card className=\"h-full flex flex-col\">\n      <CardHeader className=\"pb-2\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-2\">\n            <Icons.GitPullRequest className=\"w-4 h-4 text-green-500\" />\n            <CardTitle className=\"text-sm\">Pull Requests</CardTitle>\n            {prs.length > 0 && (\n              <Badge variant=\"info\">{prs.length}</Badge>\n            )}\n          </div>\n          <button\n            onClick={refresh}\n            className=\"text-muted-foreground hover:text-foreground transition-colors\"\n          >\n            <Icons.RefreshCw className=\"w-3 h-3\" />\n          </button>\n        </div>\n      </CardHeader>\n      <CardContent className=\"flex-1 overflow-y-auto pt-0\">\n        {prs.length === 0 ? (\n          <div className=\"flex flex-col items-center justify-center h-full gap-2\">\n            <Icons.GitPullRequest className=\"w-8 h-8 text-muted-foreground\" />\n            <span className=\"text-sm text-muted-foreground\">No open PRs</span>\n          </div>\n        ) : (\n          <div className=\"space-y-2\">\n            {prs.map((pr) => (\n              <a\n                key={`${pr.repo}-${pr.number}`}\n                href={pr.url}\n                target=\"_blank\"\n                rel=\"noopener noreferrer\"\n                className=\"block p-2 rounded-md hover:bg-muted/50 transition-colors\"\n              >\n                <div className=\"flex items-start justify-between gap-2\">\n                  <div className=\"flex-1 min-w-0\">\n                    <div className=\"flex items-center gap-1.5\">\n                      <span className=\"text-xs font-medium text-foreground truncate\">\n                        #{pr.number}\n                      </span>\n                      <Badge variant=\"default\">{pr.repo}</Badge>\n                    </div>\n                    <div className=\"text-xs text-muted-foreground truncate mt-0.5\">\n                      {pr.title}\n                    </div>\n                    <div className=\"text-[10px] text-muted-foreground/70 mt-0.5\">\n                      by {pr.author} · {formatRelativeTime(pr.createdAt)}\n                    </div>\n                  </div>\n                  <Icons.ExternalLink className=\"w-3 h-3 text-muted-foreground/50 flex-shrink-0\" />\n                </div>\n              </a>\n            ))}\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}",
    "server_code": "// Fetch open PRs from GitHub API for specified repos\nconst token = await getCredential('github');\n\nif (!token) {\n  return { error: { code: 'CREDENTIAL_MISSING', message: 'GitHub token not configured. Add it in Settings → Credentials.' } };\n}\n\nconst repos = params.repos || ['acfranzen/libra', 'acfranzen/glance'];\nconst allPRs = [];\n\nfor (const repo of repos) {\n  try {\n    const response = await fetch(`https://api.github.com/repos/${repo}/pulls?state=open&per_page=50`, {\n      headers: {\n        'Authorization': `Bearer ${token}`,\n        'Accept': 'application/vnd.github+json',\n        'X-GitHub-Api-Version': '2022-11-28'\n      }\n    });\n\n    if (response.status === 401) {\n      return { error: { code: 'UNAUTHORIZED', message: 'GitHub token is invalid or expired' } };\n    }\n\n    if (response.status === 403 && response.headers.get('X-RateLimit-Remaining') === '0') {\n      const resetTime = response.headers.get('X-RateLimit-Reset');\n      return { error: { code: 'RATE_LIMITED', message: 'GitHub API rate limit exceeded', retryAfter: parseInt(resetTime) - Math.floor(Date.now() / 1000) } };\n    }\n\n    if (!response.ok) {\n      console.error(`GitHub API error for ${repo}: ${response.status}`);\n      continue;\n    }\n\n    const prs = await response.json();\n    const repoName = repo.split('/')[1];\n    \n    for (const pr of prs) {\n      allPRs.push({\n        number: pr.number,\n        title: pr.title,\n        author: pr.user?.login || 'unknown',\n        repo: repoName,\n        url: pr.html_url,\n        createdAt: pr.created_at,\n        state: pr.state\n      });\n    }\n  } catch (err) {\n    console.error(`Failed to fetch PRs for ${repo}:`, err);\n  }\n}\n\n// Sort by creation date (newest first)\nallPRs.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));\n\nreturn {\n  prs: allPRs,\n  totalCount: allPRs.length,\n  fetchedAt: new Date().toISOString()\n};",
    "server_code_enabled": true,
    "default_size": { "w": 2, "h": 2 },
    "min_size": { "w": 1, "h": 1 },
    "refresh_interval": 300
  },
  "credentials": [
    {
      "id": "github",
      "type": "api_key",
      "name": "GitHub Personal Access Token",
      "description": "Required to fetch pull requests from GitHub repositories. Needs 'repo' scope for private repos or just public access for public repos.",
      "obtain_url": "https://github.com/settings/tokens/new?description=Glance%20Dashboard&scopes=repo",
      "obtain_instructions": "1. Go to GitHub Settings → Developer settings → Personal access tokens → Tokens (classic)\n2. Click 'Generate new token (classic)'\n3. Give it a name like 'Glance Dashboard'\n4. Select the 'repo' scope (for private repos) or leave unchecked (for public repos only)\n5. Click 'Generate token' and copy the token\n6. Paste it in Glance Settings → Credentials",
      "required_scopes": ["repo"],
      "validation": {
        "url": "https://api.github.com/user",
        "method": "GET",
        "auth_header": "Bearer"
      }
    }
  ],
  "fetch": {
    "type": "server_code"
  }
}
