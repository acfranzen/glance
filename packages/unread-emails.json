{
  "version": 1,
  "type": "glance-widget",
  "meta": {
    "name": "Unread Emails",
    "slug": "unread-emails",
    "description": "Shows unread emails from Gmail using the gog CLI (Google Workspace CLI)",
    "author": "zeus@openclaw",
    "created_at": "2026-02-03T16:00:00.000Z",
    "exported_at": "2026-02-03T16:00:00.000Z"
  },
  "widget": {
    "source_code": "function Widget() {\n  const config = useConfig();\n  const { data, loading, error, refresh } = useData('gmail', {});\n\n  const formatRelativeTime = (dateStr) => {\n    try {\n      // Parse \"2026-02-01 23:51\" format\n      const [datePart, timePart] = dateStr.split(' ');\n      const [year, month, day] = datePart.split('-').map(Number);\n      const [hour, minute] = timePart.split(':').map(Number);\n      const date = new Date(year, month - 1, day, hour, minute);\n\n      const now = new Date();\n      const diffMs = now.getTime() - date.getTime();\n      const diffMins = Math.floor(diffMs / 60000);\n\n      if (diffMins < 1) return 'just now';\n      if (diffMins < 60) return `${diffMins}m ago`;\n\n      const diffHours = Math.floor(diffMins / 60);\n      if (diffHours < 24) return `${diffHours}h ago`;\n\n      const diffDays = Math.floor(diffHours / 24);\n      if (diffDays === 1) return 'Yesterday';\n      if (diffDays < 7) return `${diffDays}d ago`;\n\n      return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });\n    } catch {\n      return dateStr;\n    }\n  };\n\n  const truncate = (text, maxLength) => {\n    if (!text) return '';\n    if (text.length <= maxLength) return text;\n    return text.slice(0, maxLength - 1) + '‚Ä¶';\n  };\n\n  if (loading) {\n    return (\n      <Card className=\"h-full\">\n        <CardContent className=\"flex items-center justify-center h-full\">\n          <Loading message=\"Loading emails...\" />\n        </CardContent>\n      </Card>\n    );\n  }\n\n  if (error && (!data || !data.emails || data.emails.length === 0)) {\n    return (\n      <Card className=\"h-full\">\n        <CardContent className=\"flex flex-col items-center justify-center h-full gap-3 p-4\">\n          <Icons.AlertCircle className=\"w-8 h-8 text-amber-500\" />\n          <div className=\"text-sm text-center text-muted-foreground\">\n            {error.message || 'Failed to load emails'}\n          </div>\n          <button\n            onClick={refresh}\n            className=\"text-xs text-primary hover:underline flex items-center gap-1\"\n          >\n            <Icons.RefreshCw className=\"w-3 h-3\" /> Retry\n          </button>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  const emails = data?.emails || [];\n\n  if (emails.length === 0) {\n    return (\n      <Card className=\"h-full\">\n        <CardContent className=\"flex flex-col items-center justify-center h-full gap-2\">\n          <Icons.Mail className=\"w-8 h-8 text-emerald-500\" />\n          <span className=\"text-sm text-muted-foreground\">Inbox zero! üéâ</span>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <Card className=\"h-full flex flex-col\">\n      <CardHeader className=\"pb-2\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-2\">\n            <Icons.Mail className=\"w-4 h-4 text-blue-500\" />\n            <CardTitle className=\"text-sm\">Unread Emails</CardTitle>\n            {emails.length > 0 && (\n              <Badge variant=\"info\">{emails.length}</Badge>\n            )}\n          </div>\n          <button\n            onClick={refresh}\n            className=\"text-muted-foreground hover:text-foreground transition-colors\"\n          >\n            <Icons.RefreshCw className=\"w-3 h-3\" />\n          </button>\n        </div>\n      </CardHeader>\n      <CardContent className=\"flex-1 overflow-y-auto pt-0\">\n        <div className=\"space-y-1.5\">\n          {emails.map((email) => (\n            <a\n              key={email.id}\n              href={email.url}\n              target=\"_blank\"\n              rel=\"noopener noreferrer\"\n              className=\"block p-2 rounded-md hover:bg-muted/50 transition-colors group\"\n            >\n              <div className=\"flex items-start justify-between gap-2\">\n                <div className=\"flex-1 min-w-0\">\n                  <div className=\"flex items-center gap-1.5\">\n                    <span className=\"text-xs font-medium text-foreground truncate\">\n                      {truncate(email.fromName, 25)}\n                    </span>\n                    {email.labels?.includes('UNREAD') && (\n                      <span className=\"w-1.5 h-1.5 bg-blue-500 rounded-full flex-shrink-0\" />\n                    )}\n                  </div>\n                  <div className=\"text-xs text-muted-foreground truncate mt-0.5\">\n                    {truncate(email.subject, 45)}\n                  </div>\n                  {email.summary && (\n                    <div className=\"text-[10px] text-muted-foreground/70 truncate mt-0.5 italic\">\n                      {truncate(email.summary, 60)}\n                    </div>\n                  )}\n                </div>\n                <div className=\"flex items-center gap-1 flex-shrink-0\">\n                  <span className=\"text-[10px] text-muted-foreground/70\">\n                    {formatRelativeTime(email.date)}\n                  </span>\n                  <Icons.ExternalLink className=\"w-3 h-3 text-muted-foreground/50 opacity-0 group-hover:opacity-100 transition-opacity\" />\n                </div>\n              </div>\n            </a>\n          ))}\n        </div>\n      </CardContent>\n      {data?.error && (\n        <div className=\"text-[10px] text-amber-500 text-center p-2\">\n          ‚ö†Ô∏è {data.error}\n        </div>\n      )}\n    </Card>\n  );\n}",
    "server_code": "// Read cached email data written by OpenClaw agent\n// The agent runs `gog gmail search` periodically and writes results to cache\nconst CACHE_PATH = '/tmp/unread-emails-cache.json';\n\nconst cacheContent = await readCacheFile(CACHE_PATH);\n\nif (!cacheContent) {\n  return {\n    emails: [],\n    fetchedAt: new Date().toISOString(),\n    error: 'No email data available. Ask OpenClaw to refresh email data.'\n  };\n}\n\ntry {\n  const data = JSON.parse(cacheContent);\n  return {\n    emails: data.emails || [],\n    fetchedAt: data.fetchedAt || new Date().toISOString(),\n    fromCache: true\n  };\n} catch (err) {\n  return {\n    emails: [],\n    fetchedAt: new Date().toISOString(),\n    error: 'Failed to parse cached email data'\n  };\n}",
    "server_code_enabled": true,
    "default_size": { "w": 2, "h": 2 },
    "min_size": { "w": 1, "h": 1 },
    "refresh_interval": 120
  },
  "credentials": [
    {
      "id": "gog-cli",
      "type": "local_software",
      "name": "gog CLI (Google Workspace CLI)",
      "description": "Command-line tool for accessing Google Workspace services (Gmail, Calendar, Drive). Must be installed and authenticated on the local machine.",
      "check_command": "which gog && gog gmail labels list --account=zeuskingclaw@gmail.com --limit=1 2>/dev/null",
      "install_url": "https://github.com/your-org/gog",
      "install_instructions": "1. Install gog: brew install gog (or download from releases)\n2. Authenticate: gog auth login\n3. Select your Google account when prompted\n4. Grant the requested permissions\n5. Verify with: gog gmail labels list"
    }
  ],
  "setup": {
    "description": "Configure OpenClaw to periodically refresh email data",
    "agent_skill": "## Email Data Refresh Setup\n\nThis widget requires OpenClaw to periodically fetch emails and write them to a cache file.\n\n### Agent Task: Refresh Emails\n\nAdd to your heartbeat or cron schedule (every 2-5 minutes):\n\n```bash\n# Fetch unread inbox emails and write to cache\ngog gmail search \"in:inbox -from:YOUR_EMAIL\" --max 10 --json --account=YOUR_EMAIL > /tmp/unread-emails-cache-raw.json\n\n# Transform to widget format\ncat /tmp/unread-emails-cache-raw.json | jq '{\n  emails: [.threads[] | {\n    id: .id,\n    from: .from,\n    fromName: (.from | split(\"<\")[0] | gsub(\"\\\"\"; \"\") | rtrimstr(\" \")),\n    subject: .subject,\n    date: .date,\n    labels: .labels,\n    url: (\"https://mail.google.com/mail/u/0/#inbox/\" + .id)\n  }],\n  fetchedAt: (now | todate)\n}' > /tmp/unread-emails-cache.json\n```\n\nOr use the simpler approach - have the agent:\n1. Run `gog gmail search \"in:inbox\" --max 10 --json`\n2. Parse the JSON output\n3. Write formatted data to `/tmp/unread-emails-cache.json`\n\n### Cache File Format\n\n```json\n{\n  \"emails\": [\n    {\n      \"id\": \"thread_id\",\n      \"from\": \"sender@example.com\",\n      \"fromName\": \"Sender Name\",\n      \"subject\": \"Email subject\",\n      \"date\": \"2026-02-01 23:51\",\n      \"labels\": [\"INBOX\", \"UNREAD\"],\n      \"url\": \"https://mail.google.com/mail/u/0/#inbox/thread_id\",\n      \"summary\": \"Optional AI-generated summary\"\n    }\n  ],\n  \"fetchedAt\": \"2026-02-01T23:51:00.000Z\"\n}\n```",
    "verification": {
      "type": "file_exists",
      "target": "/tmp/unread-emails-cache.json"
    },
    "idempotent": true,
    "estimated_time": "2 minutes"
  },
  "fetch": {
    "type": "agent_refresh",
    "cache_path": "/tmp/unread-emails-cache.json",
    "refresh_command": "gog gmail search \"in:inbox\" --max 10 --json",
    "refresh_interval": 120
  }
}
